<!doctype html>
<html lang="en">
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <title>WebSocket Demo</title>
  </head>

  <body>
    <div class="container mt-5">
      <p>Percent completed: <span id="completed">0</span>%</p>

      <div class="progress">
        <div
          class="progress-bar bg-success progress-bar-striped"
          style="width: 0%"
        ></div>
      </div>

      <table class="table mt-5">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Age</th>
            <th>Address</th>
          </tr>
        </thead>
        <tbody id="table_data"></tbody>
      </table>
    </div>

    <script>
      const socket = new WebSocket("ws://127.0.0.1:8000/ws/new/");

      socket.onopen = function () {
        console.log("WebSocket connected");
      };

      socket.onmessage = function (e) {
        const data = JSON.parse(e.data);

        if (data.payload) {
          addRow(data.payload);
        }

        if (data.progress !== undefined) {
          document.getElementById("completed").innerText = data.progress;
          document.querySelector(".progress-bar").style.width =
            data.progress + "%";
        }
      };

      socket.onclose = function () {
        console.log("WebSocket disconnected");
      };

      function addRow(data) {
        const html = `
          <tr>
            <td>${data.id}</td>
            <td>${data.student_name}</td>
            <td>${data.student_age}</td>
            <td>${data.address}</td>
          </tr>
        `;
        document.getElementById("table_data").innerHTML += html;
      }
    </script>
  </body>
</html>
